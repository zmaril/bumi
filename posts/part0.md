Let's start by asking some simple questions about the Linux kernel.
Assuming you've loaded the kernel into Titan with `lein run load`,
then we can switch over into the bumi.analysis namespace and get
started. 

``` clojure
bumi.analysis=> (ns bumi.analysis
  (:require [bumi.titan :refer (start)]
            [clojurewerkz.titanium.graph :as g]
            [clojurewerkz.titanium.vertices :as v]
            [clojurewerkz.titanium.edges :as e]
            [clojurewerkz.titanium.types :as t]
            [ogre.core :as q]))
(start) ;;Start up the database via Titanium. 
```

Let's see how many commits, people, and files we have stored in Titan:

```clojure
bumi.analysis=> (def commits (g/transact! (v/find-by-kv :type "commit")))
bumi.analysis=> (count commits)
362159

bumi.analysis=> (def people (g/transact! (v/find-by-kv :type "person")))
bumi.analysis=> (count people)
16653

bumi.analysis=> (def files (g/transact! (v/find-by-kv :type "file")))
bumi.analysis=> (count files)
73061
```

Note that we can verify that we have the correct number of commits
with the following:

``` bash
git log --pretty=format:'' | wc -l
362158
```

Off by one error! Close. 

Now let's ask some simple questions about Linus. First we must find him.

```clojure
bumi.analysis=> (def linus (g/transact! (first (v/find-by-kv :name "linus torvalds"))))
#'bumi.analysis/linus
bumi.analysis=> linus
#<CacheVertex v[14200]>
bumi.analysis=> (g/transact! (v/to-map (v/refresh linus)))
{:__id__ 14200, :name "linus torvalds", :type "person"}
```

Now, how many commits has Linus authored or committed? 
```clojure
bumi.analysis=> (g/transact! (q/query (v/refresh linus)
                                      (q/--> :authored)
                                      q/count!))
14013
bumi.analysis=> (g/transact! (q/query (v/refresh linus)
                                      (q/--> :committed)
                                      q/count!))
50188
```

So he's been directly involved in about a seventh of all the commits.
I wonder, how many different files has he touched?

;; TODO mispelled edited in the codebase. Gotta reload the database
;; now.

```clojure
bumi.analysis=> (g/transact! (q/query (v/refresh linus)
                                      (q/--> :authored :committed)
                                      (q/--> :editted :deleted :created)
                                      q/dedup
                                      q/count!))
70879
```

It seems that the vast majority of files that exist or have ever
existed inside of the Linux kernel have been effected by Linus'
commits at some point. Neat! 

Let's do some sanity checks. Every commit should only have one author
and one committer. We'll define a useful function along the way called
`degree-in` that we'll use to check how many edges with a certain set
of labels are coming into a node. 

```clojure
bumi.analysis=> (defn degree-in [v & labels] (q/query v
                                                      (#(apply q/<-- (cons % labels)))
                                                      q/count!))

bumi.analysis=> (g/transact! (->>  commits
                                   (pmap #(degree-in (v/refresh %) :authored))
                                   frequencies))
{1 362159}

bumi.analysis=> (g/transact! (->>  commits
                                   (pmap #(degree-in (v/refresh %) :committed))
                                   frequencies))
{1 362159}
```

Phew. That makes sense. Every commit only has one author and one
committer. But, I wonder, how many files does the average commit
touch? To answer this, we'll define a useful degree-out function. 

```clojure
bumi.analysis=> (defn degree-out [v & labels]
                                 (q/query v
                                          (#(apply q/--> (cons % labels)))
                                          q/count!))

bumi.analysis=> (g/transact! (->>  commits
                                   (pmap #(degree-out (v/refresh %) :deleted))
                                   frequencies))
....
(clojure.pprint/pprint (sort *1))
([0 350693]
 [1 4961]
 [2 1849]
 [3 597]
 [4 477]
 [5 319]
 [6 240]
 [7 160]
 [8 124]
 [9 113]
 [10 101]
 [11 82]
 [12 104]
 [13 76]
 [14 51]
 [15 59]
 [16 56]
 [17 53]
 [18 44]
 [19 45]
 [20 47]
 [21 43]
 [22 43]
 [23 39]
 [24 24]
 [25 45]
 [26 24]
 [27 21]
 [28 39]
 [29 15]
 [30 23]
 [31 31]
 [32 21]
 [33 23]
 [34 25]
 [35 20]
 [36 36]
 [37 21]
 [38 25]
 [39 22]
 [40 13]
 [41 17]
 [42 11]
 [43 9]
 [44 7]
 [45 13]
 [46 6]
 [47 11]
 [48 5]
 [49 11]
 [50 14]
 [51 6]
 [52 10]
 [53 6]
 [54 22]
 [55 19]
 [56 14]
 [57 2]
 [58 6]
 [59 15]
 [60 6]
 [61 5]
 [62 17]
 [63 8]
 [64 10]
 [65 22]
 [66 5]
 [67 10]
 [68 13]
 [69 6]
 [70 7]
 [71 5]
 [72 7]
 [73 8]
 [74 7]
 [75 6]
 [76 9]
 [77 2]
 [78 9]
 [79 13]
 [80 3]
 [81 3]
 [82 2]
 [83 1]
 [84 2]
 [85 4]
 [86 2]
 [88 2]
 [89 4]
 [90 4]
 [91 13]
 [92 3]
 [93 9]
 [94 21]
 [95 3]
 [96 6]
 [97 2]
 [98 2]
 [99 1]
 [100 1]
 [101 1]
 [102 3]
 [103 6]
 [104 2]
 [105 1]
 [106 4]
 [107 1]
 [108 3]
 [109 9]
 [110 2]
 [111 5]
 [112 4]
 [113 1]
 [114 7]
 [115 3]
 [116 4]
 [117 8]
 [118 2]
 [119 4]
 [120 5]
 [121 6]
 [122 5]
 [123 2]
 [124 2]
 [125 1]
 [126 8]
 [127 5]
 [128 6]
 [129 3]
 [130 6]
 [131 1]
 [132 3]
 [133 3]
 [134 3]
 [135 2]
 [137 4]
 [138 3]
 [139 4]
 [140 3]
 [141 5]
 [142 2]
 [143 3]
 [144 2]
 [145 3]
 [146 1]
 [147 5]
 [148 3]
 [149 1]
 [150 8]
 [151 2]
 [153 5]
 [154 1]
 [155 2]
 [156 2]
 [157 3]
 [158 5]
 [159 1]
 [160 1]
 [161 3]
 [162 1]
 [163 2]
 [164 3]
 [166 7]
 [167 1]
 [169 1]
 [171 2]
 [172 1]
 [173 2]
 [174 1]
 [175 6]
 [176 7]
 [177 1]
 [178 2]
 [179 1]
 [180 2]
 [181 4]
 [183 2]
 [185 7]
 [186 1]
 [187 1]
 [189 6]
 [192 4]
 [193 1]
 [194 1]
 [195 1]
 [197 5]
 [198 4]
 [199 2]
 [200 5]
 [201 1]
 [202 3]
 [204 8]
 [205 4]
 [206 3]
 [207 1]
 [208 1]
 [210 3]
 [211 2]
 [212 4]
 [213 2]
 [214 1]
 [215 2]
 [216 3]
 [217 1]
 [220 2]
 [221 3]
 [222 1]
 [223 1]
 [224 1]
 [225 1]
 [228 2]
 [229 1]
 [231 1]
 [233 1]
 [234 1]
 [235 1]
 [236 3]
 [237 2]
 [238 3]
 [239 2]
 [241 2]
 [245 3]
 [248 1]
 [249 1]
 [250 2]
 [251 1]
 [252 3]
 [253 1]
 [254 1]
 [255 2]
 [257 5]
 [259 1]
 [260 2]
 [261 3]
 [262 1]
 [263 2]
 [265 1]
 [266 1]
 [267 2]
 [268 2]
 [269 2]
 [272 1]
 [273 1]
 [274 1]
 [275 3]
 [277 1]
 [279 1]
 [280 2]
 [282 3]
 [283 2]
 [284 1]
 [288 2]
 [290 2]
 [293 1]
 [294 1]
 [296 2]
 [299 2]
 [300 1]
 [301 2]
 [302 2]
 [303 5]
 [305 1]
 [306 5]
 [307 2]
 [308 4]
 [309 2]
 [310 6]
 [311 3]
 [312 2]
 [313 5]
 [314 4]
 [316 2]
 [317 4]
 [318 1]
 [320 3]
 [321 2]
 [322 5]
 [323 2]
 [324 1]
 [325 4]
 [326 2]
 [330 3]
 [331 1]
 [332 4]
 [333 5]
 [336 1]
 [338 1]
 [339 2]
 [341 1]
 [342 2]
 [344 1]
 [345 4]
 [346 5]
 [347 4]
 [348 1]
 [350 1]
 [351 1]
 [352 2]
 [353 1]
 [354 3]
 [355 4]
 [356 2]
 [357 2]
 [366 4]
 [367 2]
 [368 1]
 [369 2]
 [370 1]
 [375 1]
 [376 2]
 [379 1]
 [380 1]
 [382 1]
 [384 4]
 [387 2]
 [391 1]
 [394 2]
 [397 1]
 [399 1]
 [400 1]
 [405 3]
 [407 2]
 [408 1]
 [409 1]
 [410 1]
 [414 1]
 [415 1]
 [416 4]
 [418 1]
 [419 1]
 [420 1]
 [421 1]
 [423 1]
 [424 1]
 [425 1]
 [427 1]
 [429 1]
 [433 2]
 [436 1]
 [439 2]
 [440 3]
 [448 1]
 [449 1]
 [451 1]
 [452 1]
 [454 1]
 [457 1]
 [458 1]
 [462 1]
 [466 1]
 [480 1]
 [490 3]
 [492 4]
 [493 1]
 [502 1]
 [503 1]
 [506 1]
 [509 2]
 [510 1]
 [511 3]
 [512 3]
 [513 1]
 [517 1]
 [519 1]
 [521 1]
 [523 2]
 [524 1]
 [528 1]
 [534 1]
 [539 2]
 [540 1]
 [542 1]
 [543 1]
 [544 2]
 [547 1]
 [554 1]
 [559 1]
 [564 1]
 [566 1]
 [567 2]
 [568 1]
 [570 1]
 [574 1]
 [576 3]
 [578 1]
 [583 1]
 [584 2]
 [585 2]
 [591 1]
 [594 1]
 [598 2]
 [601 1]
 [602 1]
 [603 5]
 [604 1]
 [607 1]
 [613 2]
 [619 1]
 [621 1]
 [622 2]
 [625 2]
 [626 1]
 [630 1]
 [637 4]
 [638 6]
 [639 1]
 [640 1]
 [641 1]
 [643 3]
 [645 1]
 [648 1]
 [652 1]
 [653 1]
 [654 1]
 [656 1]
 [657 1]
 [660 1]
 [662 1]
 [666 1]
 [672 1]
 [674 1]
 [675 1]
 [676 1]
 [680 1]
 [683 1]
 [686 2]
 [689 1]
 [690 1]
 [691 1]
 [696 1]
 [697 2]
 [703 2]
 [705 1]
 [721 1]
 [725 2]
 [729 1]
 [733 1]
 [734 1]
 [737 1]
 [739 1]
 [740 1]
 [743 1]
 [747 1]
 [748 2]
 [749 2]
 [750 1]
 [756 1]
 [757 1]
 [758 1]
 [759 1]
 [760 3]
 [761 1]
 [762 1]
 [764 1]
 [766 1]
 [770 1]
 [779 5]
 [787 1]
 [788 1]
 [790 1]
 [799 1]
 [801 2]
 [802 3]
 [804 1]
 [810 1]
 [819 1]
 [822 1]
 [825 1]
 [826 1]
 [833 2]
 [835 1]
 [837 2]
 [842 1]
 [852 1]
 [853 1]
 [859 1]
 [866 1]
 [867 1]
 [873 1]
 [874 1]
 [876 1]
 [877 2]
 [907 1]
 [913 1]
 [914 1]
 [923 1]
 [924 1]
 [925 1]
 [926 1]
 [950 1]
 [961 1]
 [993 1]
 [999 1]
 [1051 1]
 [1085 1]
 [1089 1]
 [1127 1]
 [1134 1]
 [1175 1]
 [1224 1]
 [1297 1]
 [1320 1]
 [1339 1]
 [1414 1]
 [1439 1]
 [1452 1]
 [1453 1]
 [1471 1]
 [1473 1]
 [1476 1]
 [1505 1]
 [1513 1]
 [1520 1]
 [1624 1]
 [1626 1]
 [1738 1]
 [1740 1]
 [1756 1]
 [1766 1]
 [1771 2]
 [1800 1]
 [1818 1]
 [1822 1]
 [1847 1]
 [1852 1]
 [1867 1]
 [1870 1]
 [1874 1]
 [1875 1]
 [1953 1]
 [1998 1]
 [2036 1]
 [2090 1]
 [2149 1]
 [2153 1]
 [2156 2]
 [2169 2]
 [2192 1]
 [2271 1]
 [2294 1]
 [2364 2]
 [2409 1]
 [2592 1]
 [2613 2]
 [2663 1]
 [2682 1]
 [2747 2]
 [2775 1]
 [2780 1]
 [2790 2]
 [2831 1]
 [2915 1]
 [2925 1]
 [2929 1]
 [2937 1]
 [2956 1]
 [2958 1]
 [2959 2]
 [3023 1]
 [3049 1]
 [3139 1]
 [3164 1]
 [3195 1]
 [3236 2]
 [3370 1]
 [3692 1]
 [3737 1]
 [4577 1]
 [4678 1])
```

Wasn't that so enlightening? Not so much. We should probably start
making these things pretty, otherwise we will be stuck with some kind
of pointless lists of data.

``` clojure
bumi.analysis=> (g/transact! (->>  commits
                                   (pmap #(degree-out % :changed))
                                   frequencies))

bumi.analysis=> (g/transact! (->>  commits
                                   (pmap #(degree-out % :editted))
                                   frequencies))
```

Work in progress. 